define("bundles/ondemand/components/quiz/QuizItem",["require","exports","module","classnames","q","react-with-addons","underscore","bundles/assess/assessmentTypes/phoenixQuiz/assessment","bundles/assess/assessmentTypes/phoenixQuiz/assessment.attempt","bundles/content-feedback/constants/ItemTypes","bundles/ondemand/components/ItemLayout","bundles/ondemand/components/item/LightItemLayout","bundles/ondemand/utils/itemViewValidator","bundles/phoenix/components/OrigamiRegion","js/lib/getPropsFromPromise","js/lib/waitFor","pages/open-course/assessment/clients/contentRequesterAssessmentClient","pages/open-course/assessment/clients/naptimeAssessmentClient","pages/open-course/assessment/models/exam/assessment","pages/open-course/assessment/models/openSinglePage/assessment","pages/open-course/assessment/models/quiz/assessment","pages/open-course/common/contentRequester","pages/open-course/common/models/itemMetadata","pages/open-course/common/naptimeItemClient","pages/open-course/common/singletons/course","pages/open-course/common/singletons/courseGrade","pages/open-course/common/singletons/courseMaterials","pages/open-course/common/singletons/courseProgress","pages/open-course/common/singletons/verificationDisplay","pages/open-course/common/utils/lockExperiment","pages/open-course/verification/views/verification"],function(require,exports,module){"use strict";function _defaults(e,o){for(var r=Object.getOwnPropertyNames(o),s=0;s<r.length;s++){var t=r[s],n=Object.getOwnPropertyDescriptor(o,t);n&&n.configurable&&void 0===e[t]&&Object.defineProperty(e,t,n)}return e}function _classCallCheck(e,s){if(!(e instanceof s))throw new TypeError("Cannot call a class as a function")}function _inherits(s,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);s.prototype=Object.create(e&&e.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(s,e):_defaults(s,e))}function getContentModelPromise(e){if("assessOpenSinglePage"===e.getTypeName())return P({metadata:e});if("quiz"===e.getTypeName())return w({metadata:e});if("exam"===e.getTypeName())return h({metadata:e})}function getClient(e){if("assessOpenSinglePage"===e.getTypeName()||"quiz"===e.getTypeName()){var s=new O(e);return new b(s)}if("exam"===e.getTypeName()){var t=new j(e);return new v(e,t)}}var t=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var t in s)Object.prototype.hasOwnProperty.call(s,t)&&(n[t]=s[t])}return n},n=function(){function defineProperties(n,t){for(var s=0;s<t.length;s++){var e=t[s];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(n,e.key,e)}}return function(e,s,t){return s&&defineProperties(e.prototype,s),t&&defineProperties(e,t),e}}(),o=function get(r,p,u){var t=!0;e:for(;t;){var s=r,a=p,i=u;t=!1,null===s&&(s=Function.prototype);var e=Object.getOwnPropertyDescriptor(s,a);if(void 0===e){var n=Object.getPrototypeOf(s);if(null===n)return void 0;r=n,p=a,u=i,t=!0,e=n=void 0;continue e}if("value"in e)return e.value;var o=e.get;if(void 0===o)return void 0;return o.call(i)}},r=require("classnames"),a=require("q"),e=require("react-with-addons"),i=require("underscore"),p=i.compose,u=require("bundles/assess/assessmentTypes/phoenixQuiz/assessment"),c=require("bundles/assess/assessmentTypes/phoenixQuiz/assessment.attempt"),m=require("bundles/content-feedback/constants/ItemTypes"),l=require("bundles/ondemand/components/ItemLayout"),d=require("bundles/ondemand/components/item/LightItemLayout"),g=require("bundles/ondemand/utils/itemViewValidator"),f=require("bundles/phoenix/components/OrigamiRegion"),s=require("js/lib/getPropsFromPromise"),y=require("js/lib/waitFor"),b=require("pages/open-course/assessment/clients/contentRequesterAssessmentClient"),v=require("pages/open-course/assessment/clients/naptimeAssessmentClient"),h=require("pages/open-course/assessment/models/exam/assessment"),P=require("pages/open-course/assessment/models/openSinglePage/assessment"),w=require("pages/open-course/assessment/models/quiz/assessment"),O=require("pages/open-course/common/contentRequester"),T=require("pages/open-course/common/models/itemMetadata"),j=require("pages/open-course/common/naptimeItemClient"),q=require("pages/open-course/common/singletons/course"),x=require("pages/open-course/common/singletons/courseGrade"),M=require("pages/open-course/common/singletons/courseMaterials"),C=require("pages/open-course/common/singletons/courseProgress"),I=require("pages/open-course/common/singletons/verificationDisplay"),R=require("pages/open-course/common/utils/lockExperiment"),z=require("pages/open-course/verification/views/verification"),L={start:u,verify:z,attempt:c},k=function(s){function QuizItem(){var e=this;_classCallCheck(this,QuizItem),o(Object.getPrototypeOf(QuizItem.prototype),"constructor",this).apply(this,arguments),this.state={state:"start",stateOptions:{}},this.onStateChange=function(s,t){e.setState({state:s,stateOptions:t||{}})}}return _inherits(QuizItem,s),n(QuizItem,[{key:"componentDidMount",value:function componentDidMount(){var e=this.props,s=e.course,t=e.courseMaterials,n=e.courseGrade,o=e.courseProgress;R.setup(s.get("id"),t,n,o)}},{key:"renderView",value:function renderView(){var a=this.props.isLoaded,n=this.state,s=n.state,i=n.stateOptions,o=L[s];if(!o)throw new Error("Unknown state: "+s);var p=r("rc-QuizItem",{state:s});return e.createElement("div",{className:p},a&&e.createElement(f,{ViewClass:o,viewOptions:t({},this.props,i,{onStateChange:this.onStateChange})}))}},{key:"render",value:function render(){var t=this.props.itemMetadata,n=this.state.state,s=this.renderView();return"start"===n?e.createElement(l,null,e.createElement(d,{itemMetadata:t,itemType:m.Quiz,isCard:!0},s)):s}}],[{key:"propTypes",value:{itemMetadata:e.PropTypes.instanceOf(T).isRequired,course:e.PropTypes.object.isRequired,courseProgress:e.PropTypes.object.isRequired,courseMaterials:e.PropTypes.object.isRequired,courseGrade:e.PropTypes.object.isRequired,verificationDisplay:e.PropTypes.object.isRequired,model:e.PropTypes.object.isRequired,nextItemMetadata:e.PropTypes.object.isRequired,isLoaded:e.PropTypes.bool},enumerable:!0}]),QuizItem}(e.Component),E=g(k,{renderItemLayout:!0});module.exports=p(s(function(s,t){var e=s.itemMetadata;return a.all([getContentModelPromise(e),q,x,C,M,I]).spread(function(t,n,o,r,s,a){return{isLoaded:!0,course:n,courseProgress:r,courseMaterials:s,courseGrade:o,verificationDisplay:a,assessmentClient:getClient(e),model:t,nextItemMetadata:s.getNeighboringItemMetadata(e).next}})}),y(function(e){var s=e.isLoaded;return!!s}))(E)});